# Breast Cancer Pipeline (Airflow ETL Project)

## Цель проекта

Проектирование и реализация автоматизированного ETL-процесса: от получения медицинских данных до выгрузки результатов модели в облачное хранилище с помощью Apache Airflow и Python. 

---

## Содержание

* [Цель проекта](#цель-проекта)
* [Описание пайплайна](#описание-пайплайна)
* [Описание DAG](#описание-dag)
* [Инструкция по запуску](#инструкция-по-запуску)
* [Интеграция с хранилищем](#интеграция-с-хранилищем)
* [Анализ устойчивости](#анализ-устойчивости)
* [Развитие проекта](#развитие-проекта)
* [Скриншоты](#скриншоты)

---

## Описание пайплайна

### ML-задача

Бинарная классификация на основании данных из датасета Breast Cancer Wisconsin Diagnostic: предсказание злокачественности опухоли (М - Malignant злокачественная, B - Benign доброкачественная) на основе предоставленных медицинских данных.

### Структура пайплайна

**Этапы:**

1. `load_data.py` — загрузка данных, добавление наименований признаков.
2. `clean_data.py` — удаление пропусков и неинформативных признаков, преобразование данных, приведение к нужному формату.
3. `train_model.py` — нормализация и обучение модели `LogisticRegression`.
4. `calc_metrics.py` — расчет метрик и сохранение в `results/metrics.json`.

### Схема

```
+------------+      +------------+      +--------------+      +-------------+
|  load_data | ---> | clean_data | ---> | train_model  | ---> | calc_metrics|
+------------+      +------------+      +--------------+      +-------------+

```

---

## Описание DAG

* **Название DAG:** `breast_cancer_pipeline`
* **Тип:** без расписания (`schedule_interval=None`)
* **Зависимости задач:** линейная последовательность: загрузка → очистка → обучение → расчет метрик.

### Описание операторов

* `PythonOperator` с функцией `run_script(script_name)` запускает каждый из `.py` скриптов через `subprocess`.
* Логи пишутся в `logs/`.

---

## Инструкция по запуску

1. Активируйте Airflow:

   ```bash
   airflow scheduler &
   airflow webserver
   ```
2. В интерфейсе Airflow включите DAG `breast_cancer_pipeline` и запустите вручную.
3. Либо в терминале:

   ```bash
   airflow tasks test breast_cancer_pipeline load_data 2025-06-28
   ```

---

## Интеграция с хранилищем

### Локальное хранилище

Результаты пайплайна (модель и метрики) сохраняются в подкаталог `results/`:

* `results/model.pkl` — обученная модель.
* `results/metrics.json` — метрики качества.

### Структура

```
airflow_project/
├── dags/
├── etl/
├── logs/
└── results/
    ├── model.pkl
    └── metrics.json
```

---

## Анализ устойчивости

### Потенциальные точки сбоя

| Этап              | Возможные сбои                                 | Обработка                            |
| ----------------- | ---------------------------------------------- | ------------------------------------ |
| `load_data.py`    | Отсутствие файла, некорректный CSV             | Исключение + логирование             |
| `clean_data.py`   | Null-значения, ошибки типов                    | Предобработка + логирование          |
| `train_model.py`  | Модель не обучается, ошибка sklearn            | Обернуто в `try/except`, логгируется |
| `calc_metrics.py` | Невалидные данные, ошибка при сохранении файла | Логгирование + проверка схемы        |

### Обработка сбоев и устойчивость

* **Retries:** у каждой задачи указан `retries=1` и `retry_delay=300` (через 5 минут).
* **Изоляция:** каждый шаг — отдельный Python-скрипт (модуль).
* **Логирование:** реализовано на каждом этапе.
* **Валидация данных:** проверка на пустые фреймы, структуры, размерности.

Пример:

* Потеря доступа к данным → задача падает, лог сохраняется, повторная попытка через 5 минут.
* Невалидная модель → `train_model.py` выбрасывает исключение, пайплайн не продолжается до исправления.

---

## Развитие проекта

* Заменить `subprocess` на `PythonVirtualenvOperator`/`PythonOperator` с импортом функций.
* Визуализация метрик и логов в веб-интерфейсе.
* Использование S3-хранилища и MinIO.
* Добавление тестов данных с Great Expectations.

---

## Скриншоты

(вставьте сюда изображение DAG-а и, при необходимости, структуры проекта)

---

**Автор:** NatalieGo
**Проект:** ETL для классификации рака груди с использованием Airflow

